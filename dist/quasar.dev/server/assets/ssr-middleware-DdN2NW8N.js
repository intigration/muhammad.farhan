import{resolveComponent as R,mergeProps as q,withCtx as c,createTextVNode as a,unref as p,createVNode as n,useSSRContext as P}from"vue";import{ssrRenderComponent as u}from"vue/server-renderer";import{c as m}from"./page-utils-C-QWsEHe.js";import{D as j,a as f}from"./DocPage-DKr-0pQn.js";import{D as k}from"./DocPrerender-DPOnWPFO.js";import{C as o}from"./CopyButton-l3ndfN49.js";import{_ as C}from"../server-entry.js";import"quasar";import"@quasar/extras/mdi-v6";import"vue-router";import"@quasar/extras/fontawesome-v5";import"@quasar/extras/fontawesome-v6";import"@quasar/extras/mdi-v7";import"quasar/icon-set/svg-mdi-v6.mjs";const g={__name:"ssr-middleware",__ssrInlineRender:!0,setup(y){const w=[{name:"The quasar.config file",category:"Quasar CLI (with Vite)",path:"/quasar-cli-vite/quasar-config-file"}],h=[{id:"anatomy-of-a-middleware-file",title:"2. Anatomy of a middleware file"},{id:"middleware-object-parameter",title:"3. Middleware object parameter"},{id:"usage-of-ssr-middleware",title:"4. Usage of SSR middleware"},{id:"the-ssr-render-middleware",title:"5. The SSR render middleware"},{id:"hot-module-reload",title:"6. Hot Module Reload"},{id:"examples-of-ssr-middleware",title:"7. Examples of SSR middleware"},{id:"logger-interceptor",title:"7.1. Logger / Interceptor",sub:!0}];return(T,b,S,x)=>{const $=R("q-markup-table");b(u(j,q({title:"SSR Middleware",desc:"(@quasar/app-vite) Managing the SSR middleware in a Quasar app.",overline:"Quasar CLI with Vite - @quasar/app-vite",heading:"","edit-link":"quasar-cli-vite/developing-ssr/ssr-middleware",toc:h,related:w},x),{default:c((N,l,d,t)=>{if(l)l(`<p${t}>The SSR middleware files fulfill one special purpose: they prepare the Nodejs server that runs your SSR app with additional functionality (Expressjs compatible middleware).</p><p${t}>With SSR middleware files, it is possible to split the middleware logic into self-contained, easy to maintain files. It is also trivial to disable any of the SSR middleware files or even contextually determine which of the SSR middleware files get into the build through the <code class="doc-token"${t}>/quasar.config</code> file configuration.</p><div class="doc-note doc-note--tip"${t}><p class="doc-note__title"${t}>TIP</p><p${t}>For more advanced usage, you will need to get acquainted to the `),l(u(f,{to:"https://expressjs.com/en/4x/api.html"},{default:c((i,e,r,s)=>{if(e)e("Expressjs API");else return[a("Expressjs API")]}),_:1},d,t)),l(`.</p></div><div class="doc-note doc-note--warning"${t}><p class="doc-note__title"${t}>WARNING</p><p${t}>You will need at least one SSR middleware file which handles the rendering of the page with Vue (which should be positioned as last in the middlewares list). When SSR mode is added to your Quasar CLI project, this will be scaffolded into <code class="doc-token"${t}>src-ssr/middlewares/render.js</code>.</p></div><h2 id="anatomy-of-a-middleware-file" class="doc-heading doc-h2"${t}>Anatomy of a middleware file</h2><p${t}>A SSR middleware file is a simple JavaScript file which exports a function. Quasar will then call the exported function when it prepares the Nodejs server (Expressjs) app and additionally pass an Object as param (which will be detailed in the next section).</p>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token comment"${s}>// import something here</span>

<span class="token keyword"${s}>export</span> <span class="token keyword"${s}>default</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}><span class="token punctuation"${s}>{</span> app<span class="token punctuation"${s}>,</span> port<span class="token punctuation"${s}>,</span> resolve<span class="token punctuation"${s}>,</span> publicPath<span class="token punctuation"${s}>,</span> folders<span class="token punctuation"${s}>,</span> render<span class="token punctuation"${s}>,</span> serve <span class="token punctuation"${s}>}</span></span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
  <span class="token comment"${s}>// something to do with the server &quot;app&quot;</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// import something here"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},'// something to do with the server "app"'),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<p${t}>The SSR middleware files can also be async:</p>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token comment"${s}>// import something here</span>

<span class="token keyword"${s}>export</span> <span class="token keyword"${s}>default</span> <span class="token keyword"${s}>async</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}><span class="token punctuation"${s}>{</span> app<span class="token punctuation"${s}>,</span> port<span class="token punctuation"${s}>,</span> resolve<span class="token punctuation"${s}>,</span> publicPath<span class="token punctuation"${s}>,</span> folders<span class="token punctuation"${s}>,</span> render<span class="token punctuation"${s}>,</span> serve <span class="token punctuation"${s}>}</span></span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
  <span class="token comment"${s}>// something to do with the server &quot;app&quot;</span>
  <span class="token keyword"${s}>await</span> <span class="token function"${s}>something</span><span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>)</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// import something here"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token keyword"},"async"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},'// something to do with the server "app"'),a(`
  `),n("span",{class:"token keyword"},"await"),a(),n("span",{class:"token function"},"something"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<p${t}>You can wrap the returned function with <code class="doc-token"${t}>ssrMiddleware</code> helper to get a better IDE autocomplete experience (through Typescript):</p>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token keyword"${s}>import</span> <span class="token punctuation"${s}>{</span> ssrMiddleware <span class="token punctuation"${s}>}</span> <span class="token keyword"${s}>from</span> <span class="token string"${s}>&#39;quasar/wrappers&#39;</span>

<span class="token keyword"${s}>export</span> <span class="token keyword"${s}>default</span> <span class="token function"${s}>ssrMiddleware</span><span class="token punctuation"${s}>(</span><span class="token keyword"${s}>async</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}><span class="token punctuation"${s}>{</span> app<span class="token punctuation"${s}>,</span> port<span class="token punctuation"${s}>,</span> resolve<span class="token punctuation"${s}>,</span> publicPath<span class="token punctuation"${s}>,</span> folders<span class="token punctuation"${s}>,</span> render<span class="token punctuation"${s}>,</span> serve <span class="token punctuation"${s}>}</span></span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
  <span class="token comment"${s}>// something to do</span>
  <span class="token keyword"${s}>await</span> <span class="token function"${s}>something</span><span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>)</span>
<span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"import"),a(),n("span",{class:"token punctuation"},"{"),a(" ssrMiddleware "),n("span",{class:"token punctuation"},"}"),a(),n("span",{class:"token keyword"},"from"),a(),n("span",{class:"token string"},"'quasar/wrappers'"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token function"},"ssrMiddleware"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"async"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},"// something to do"),a(`
  `),n("span",{class:"token keyword"},"await"),a(),n("span",{class:"token function"},"something"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")])]),n(o)]}),_:1},d,t)),l(`<p${t}>Notice we are using the `),l(u(f,{to:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment"},{default:c((i,e,r,s)=>{if(e)e("ES6 destructuring assignment");else return[a("ES6 destructuring assignment")]}),_:1},d,t)),l(`. Only assign what you actually need/use.</p><h2 id="middleware-object-parameter" class="doc-heading doc-h2"${t}>Middleware object parameter</h2><p${t}>We are referring here to the Object received as parameter by the default exported function of the SSR middleware file.</p>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token keyword"${s}>export</span> <span class="token keyword"${s}>default</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}><span class="token punctuation"${s}>{</span> app<span class="token punctuation"${s}>,</span> port<span class="token punctuation"${s}>,</span> resolve<span class="token punctuation"${s}>,</span> publicPath<span class="token punctuation"${s}>,</span> folders<span class="token punctuation"${s}>,</span> render<span class="token punctuation"${s}>,</span> serve <span class="token punctuation"${s}>}</span></span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{")])]),n(o)]}),_:1},d,t)),l(`<p${t}>Detailing the Object:</p>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token punctuation"${s}>{</span>
  app<span class="token punctuation"${s}>,</span> <span class="token comment"${s}>// Node.js app instance</span>
  port<span class="token punctuation"${s}>,</span> <span class="token comment"${s}>// Nodej.js webserver configured port</span>
  <span class="token literal-property property"${s}>resolve</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>{</span>
    <span class="token function"${s}>urlPath</span><span class="token punctuation"${s}>(</span>path<span class="token punctuation"${s}>)</span>
    <span class="token function"${s}>root</span><span class="token punctuation"${s}>(</span>arg1<span class="token punctuation"${s}>,</span> arg2<span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>,</span>
    <span class="token keyword"${s}>public</span><span class="token punctuation"${s}>(</span>arg1<span class="token punctuation"${s}>,</span> arg2<span class="token punctuation"${s}>)</span>
  <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>,</span>
  publicPath<span class="token punctuation"${s}>,</span> <span class="token comment"${s}>// String</span>
  <span class="token literal-property property"${s}>folders</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>{</span>
    root<span class="token punctuation"${s}>,</span>     <span class="token comment"${s}>// String</span>
    <span class="token keyword"${s}>public</span>    <span class="token comment"${s}>// String</span>
  <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>,</span>
  <span class="token function"${s}>render</span><span class="token punctuation"${s}>(</span>ssrContext<span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>,</span>
  <span class="token literal-property property"${s}>serve</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>{</span>
    <span class="token keyword"${s}>static</span><span class="token punctuation"${s}>(</span>path<span class="token punctuation"${s}>,</span> opts<span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>,</span>
    <span class="token function"${s}>error</span><span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>{</span> err<span class="token punctuation"${s}>,</span> req<span class="token punctuation"${s}>,</span> res <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
  <span class="token punctuation"${s}>}</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token punctuation"},"{"),a(`
  app`),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token comment"},"// Node.js app instance"),a(`
  port`),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token comment"},"// Nodej.js webserver configured port"),a(`
  `),n("span",{class:"token literal-property property"},"resolve"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
    `),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),a("path"),n("span",{class:"token punctuation"},")"),a(`
    `),n("span",{class:"token function"},"root"),n("span",{class:"token punctuation"},"("),a("arg1"),n("span",{class:"token punctuation"},","),a(" arg2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(`
    `),n("span",{class:"token keyword"},"public"),n("span",{class:"token punctuation"},"("),a("arg1"),n("span",{class:"token punctuation"},","),a(" arg2"),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),a(`
  publicPath`),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token comment"},"// String"),a(`
  `),n("span",{class:"token literal-property property"},"folders"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
    root`),n("span",{class:"token punctuation"},","),a("     "),n("span",{class:"token comment"},"// String"),a(`
    `),n("span",{class:"token keyword"},"public"),a("    "),n("span",{class:"token comment"},"// String"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),a(`
  `),n("span",{class:"token function"},"render"),n("span",{class:"token punctuation"},"("),a("ssrContext"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(`
  `),n("span",{class:"token literal-property property"},"serve"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
    `),n("span",{class:"token keyword"},"static"),n("span",{class:"token punctuation"},"("),a("path"),n("span",{class:"token punctuation"},","),a(" opts"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(`
    `),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" err"),n("span",{class:"token punctuation"},","),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<h4 id="app" class="doc-heading doc-h4"${t}>app</h4><p${t}>This is the Node.js app instance. The “bread and butter” of any middleware since you’ll be using it to configure the webserver.</p><h4 id="port" class="doc-heading doc-h4"${t}>port</h4><p${t}>The configured port for the Node.js webserver.</p><h4 id="resolve" class="doc-heading doc-h4"${t}>resolve</h4>`),l(u($,{class:"doc-page-table","wrap-cells":!0,flat:!0,bordered:!0},{default:c((i,e,r,s)=>{if(e)e(`<thead${s}><tr${s}><th class="text-left"${s}>Prop name</th><th class="text-left"${s}>Description</th></tr></thead><tbody${s}><tr${s}><td${s}><code class="doc-token"${s}>urlPath(path)</code></td><td${s}>Whenever you define a route (with app.use(), app.get(), app.post() etc), you should use the <code class="doc-token"${s}>resolve.urlPath()</code> method so that you’ll also keep into account the configured publicPath (quasar.config file &gt; build &gt; publicPath).</td></tr><tr${s}><td${s}><code class="doc-token"${s}>root(path1[, path2, ...pathN])</code></td><td${s}>Resolve folder path to the root (of the project in dev and of the distributables in production). Under the hood, it does a <code class="doc-token"${s}>path.join()</code>.</td></tr><tr${s}><td${s}><code class="doc-token"${s}>public(path1[, path2, ...pathN])</code></td><td${s}>Resolve folder path to the “public” folder. Under the hood, it does a <code class="doc-token"${s}>path.join()</code>.</td></tr></tbody>`);else return[n("thead",null,[n("tr",null,[n("th",{class:"text-left"},"Prop name"),n("th",{class:"text-left"},"Description")])]),n("tbody",null,[n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"urlPath(path)")]),n("td",null,[a("Whenever you define a route (with app.use(), app.get(), app.post() etc), you should use the "),n("code",{class:"doc-token"},"resolve.urlPath()"),a(" method so that you’ll also keep into account the configured publicPath (quasar.config file > build > publicPath).")])]),n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"root(path1[, path2, ...pathN])")]),n("td",null,[a("Resolve folder path to the root (of the project in dev and of the distributables in production). Under the hood, it does a "),n("code",{class:"doc-token"},"path.join()"),a(".")])]),n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"public(path1[, path2, ...pathN])")]),n("td",null,[a("Resolve folder path to the “public” folder. Under the hood, it does a "),n("code",{class:"doc-token"},"path.join()"),a(".")])])])]}),_:1},d,t)),l(`<h4 id="publicpath" class="doc-heading doc-h4"${t}>publicPath</h4><p${t}>The configured quasar.config file &gt; build &gt; publicPath</p><h4 id="folders" class="doc-heading doc-h4"${t}>folders</h4><p${t}>The <code class="doc-token"${t}>folders</code> is sometimes needed because the exact path to root folder and to the public folder differs in a production build than in a development build. So by using <code class="doc-token"${t}>folders</code> you won’t need to mind about this.</p>`),l(u($,{class:"doc-page-table","wrap-cells":!0,flat:!0,bordered:!0},{default:c((i,e,r,s)=>{if(e)e(`<thead${s}><tr${s}><th class="text-left"${s}>Prop name</th><th class="text-left"${s}>Description</th></tr></thead><tbody${s}><tr${s}><td${s}><code class="doc-token"${s}>root</code></td><td${s}>Full path to the root (of the project in dev and of the distributables in production).</td></tr><tr${s}><td${s}><code class="doc-token"${s}>public</code></td><td${s}>Full path to the “public” folder.</td></tr></tbody>`);else return[n("thead",null,[n("tr",null,[n("th",{class:"text-left"},"Prop name"),n("th",{class:"text-left"},"Description")])]),n("tbody",null,[n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"root")]),n("td",null,"Full path to the root (of the project in dev and of the distributables in production).")]),n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"public")]),n("td",null,"Full path to the “public” folder.")])])]}),_:1},d,t)),l(`<h4 id="render" class="doc-heading doc-h4"${t}>render</h4><ul${t}><li${t}>Syntax: <code class="doc-token"${t}>&lt;Promise(String)&gt; render(ssrContext)</code>.</li><li${t}>Description: Uses Vue and Vue Router to render the requested URL path. Returns the rendered HTML string to return to the client.</li></ul><h4 id="serve" class="doc-heading doc-h4"${t}>serve</h4><p${t}>serve.static():</p><ul${t}><li${t}><p${t}>Syntax: <code class="doc-token"${t}>&lt;middlewareFn&gt; serve.static(pathFromPublicFolder, opts)</code></p></li><li${t}><p${t}>Description: It’s essentially a wrapper over <code class="doc-token"${t}>express.static()</code> with a few convenient tweaks:</p><ul${t}><li${t}>the <code class="doc-token"${t}>pathFromPublicFolder</code> is a path resolved to the “public” folder out of the box</li><li${t}>the <code class="doc-token"${t}>opts</code> are the same as for <code class="doc-token"${t}>express.static()</code></li><li${t}><code class="doc-token"${t}>opts.maxAge</code> is used by default, taking into account the quasar.config file &gt; ssr &gt; maxAge configuration; this sets how long the respective file(s) can live in browser’s cache</li></ul>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}>serve<span class="token punctuation"${s}>.</span><span class="token function"${s}>static</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;my-file.json&#39;</span><span class="token punctuation"${s}>)</span>

<span class="token comment"${s}>// is equivalent to:</span>

express<span class="token punctuation"${s}>.</span><span class="token function"${s}>static</span><span class="token punctuation"${s}>(</span>resolve<span class="token punctuation"${s}>.</span><span class="token function"${s}>public</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;my-file.json&#39;</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>,</span> <span class="token punctuation"${s}>{</span>
  <span class="token literal-property property"${s}>maxAge</span><span class="token operator"${s}>:</span> <span class="token operator"${s}>...</span> <span class="token comment"${s}>// quasar.config file &gt; ssr &gt; maxAge</span>
<span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[a("serve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"static"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'my-file.json'"),n("span",{class:"token punctuation"},")"),a(`

`),n("span",{class:"token comment"},"// is equivalent to:"),a(`

express`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"static"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"public"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'my-file.json'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"maxAge"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token operator"},"..."),a(),n("span",{class:"token comment"},"// quasar.config file > ssr > maxAge"),a(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")])]),n(o)]}),_:1},d,t)),l(`</li></ul><p${t}>serve.error():</p><ul${t}><li${t}>Syntax: <code class="doc-token"${t}>&lt;void&gt; serve.error({ err, req, res })</code></li><li${t}>Description: Displays a wealth of useful debug information (including the stack trace).</li><li${t}>It’s available only in development and <strong${t}>NOT in production</strong>.</li></ul><h2 id="usage-of-ssr-middleware" class="doc-heading doc-h2"${t}>Usage of SSR middleware</h2><p${t}>The first step is always to generate a new SSR middleware file using Quasar CLI:</p>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}>$ quasar new ssrmiddleware <span class="token operator"${s}>&lt;</span>name<span class="token operator"${s}>&gt;</span></code></pre>`),e(u(o,{lang:"bash"},null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[a("$ quasar new ssrmiddleware "),n("span",{class:"token operator"},"<"),a("name"),n("span",{class:"token operator"},">")])]),n(o,{lang:"bash"})]}),_:1},d,t)),l(`<p${t}>Where <code class="doc-token"${t}>&lt;name&gt;</code> should be exchanged by a suitable name for your SSR middleware file.</p><p${t}>This command creates a new file: <code class="doc-token"${t}>/src-ssr/middlewares/&lt;name&gt;.js</code> with the following content:</p>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token comment"${s}>// import something here</span>

<span class="token comment"${s}>// &quot;async&quot; is optional!</span>
<span class="token comment"${s}>// remove it if you don&#39;t need it</span>
<span class="token keyword"${s}>export</span> <span class="token keyword"${s}>default</span> <span class="token keyword"${s}>async</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}><span class="token punctuation"${s}>{</span> app<span class="token punctuation"${s}>,</span> port<span class="token punctuation"${s}>,</span> resolveUrlPath<span class="token punctuation"${s}>,</span> publicPath<span class="token punctuation"${s}>,</span> folders<span class="token punctuation"${s}>,</span> render<span class="token punctuation"${s}>,</span> serve <span class="token punctuation"${s}>}</span></span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
  <span class="token comment"${s}>// something to do with the server &quot;app&quot;</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// import something here"),a(`

`),n("span",{class:"token comment"},'// "async" is optional!'),a(`
`),n("span",{class:"token comment"},"// remove it if you don't need it"),a(`
`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token keyword"},"async"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolveUrlPath"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},'// something to do with the server "app"'),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<p${t}>You can also return a Promise:</p>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token comment"${s}>// import something here</span>

<span class="token keyword"${s}>export</span> <span class="token keyword"${s}>default</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}><span class="token punctuation"${s}>{</span> app<span class="token punctuation"${s}>,</span> port<span class="token punctuation"${s}>,</span> resolve<span class="token punctuation"${s}>,</span> publicPath<span class="token punctuation"${s}>,</span> folders<span class="token punctuation"${s}>,</span> render<span class="token punctuation"${s}>,</span> serve <span class="token punctuation"${s}>}</span></span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
  <span class="token keyword"${s}>return</span> <span class="token keyword"${s}>new</span> <span class="token class-name"${s}>Promise</span><span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>(</span><span class="token parameter"${s}>resolve<span class="token punctuation"${s}>,</span> reject</span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
    <span class="token comment"${s}>// something to do with the server &quot;app&quot;</span>
  <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// import something here"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token keyword"},"return"),a(),n("span",{class:"token keyword"},"new"),a(),n("span",{class:"token class-name"},"Promise"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[a("resolve"),n("span",{class:"token punctuation"},","),a(" reject")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
    `),n("span",{class:"token comment"},'// something to do with the server "app"'),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<p${t}>You can now add content to that file depending on the intended use of your SSR middleware file.</p><p${t}>The last step is to tell Quasar to use your new SSR middleware file. For this to happen you need to add the file in the <code class="doc-token"${t}>/quasar.config</code> file:</p>`),l(u(p(k),{title:"/quasar.config file"},{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token literal-property property"${s}>ssr</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>{</span>
  <span class="token literal-property property"${s}>middlewares</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>[</span>
    <span class="token comment"${s}>// references /src-ssr/middlewares/&lt;name&gt;.js</span>
    <span class="token string"${s}>&#39;&lt;name&gt;&#39;</span>
  <span class="token punctuation"${s}>]</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token literal-property property"},"ssr"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"middlewares"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"["),a(`
    `),n("span",{class:"token comment"},"// references /src-ssr/middlewares/<name>.js"),a(`
    `),n("span",{class:"token string"},"'<name>'"),a(`
  `),n("span",{class:"token punctuation"},"]"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<p${t}>When building a SSR app, you may want some boot files to run only on production or only on development, in which case you can do so like below:</p>`),l(u(p(k),{title:"/quasar.config file"},{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token literal-property property"${s}>ssr</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>{</span>
  <span class="token literal-property property"${s}>middlewares</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>[</span>
    ctx<span class="token punctuation"${s}>.</span>prod <span class="token operator"${s}>?</span> <span class="token string"${s}>&#39;&lt;name&gt;&#39;</span> <span class="token operator"${s}>:</span> <span class="token string"${s}>&#39;&#39;</span><span class="token punctuation"${s}>,</span> <span class="token comment"${s}>// I run only on production!</span>
    ctx<span class="token punctuation"${s}>.</span>dev <span class="token operator"${s}>?</span> <span class="token string"${s}>&#39;&lt;name&gt;&#39;</span> <span class="token operator"${s}>:</span> <span class="token string"${s}>&#39;&#39;</span> <span class="token comment"${s}>// I run only on development</span>
  <span class="token punctuation"${s}>]</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token literal-property property"},"ssr"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"middlewares"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"["),a(`
    ctx`),n("span",{class:"token punctuation"},"."),a("prod "),n("span",{class:"token operator"},"?"),a(),n("span",{class:"token string"},"'<name>'"),a(),n("span",{class:"token operator"},":"),a(),n("span",{class:"token string"},"''"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token comment"},"// I run only on production!"),a(`
    ctx`),n("span",{class:"token punctuation"},"."),a("dev "),n("span",{class:"token operator"},"?"),a(),n("span",{class:"token string"},"'<name>'"),a(),n("span",{class:"token operator"},":"),a(),n("span",{class:"token string"},"''"),a(),n("span",{class:"token comment"},"// I run only on development"),a(`
  `),n("span",{class:"token punctuation"},"]"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<p${t}>In case you want to specify SSR middleware file from node_modules, you can do so by prepending the path with <code class="doc-token"${t}>~</code> (tilde) character:</p>`),l(u(p(k),{title:"/quasar.config file"},{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token literal-property property"${s}>ssr</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>{</span>
  <span class="token literal-property property"${s}>middlewares</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>[</span>
    <span class="token comment"${s}>// boot file from an npm package</span>
    <span class="token string"${s}>&#39;~my-npm-package/some/file&#39;</span>
  <span class="token punctuation"${s}>]</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token literal-property property"},"ssr"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"middlewares"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"["),a(`
    `),n("span",{class:"token comment"},"// boot file from an npm package"),a(`
    `),n("span",{class:"token string"},"'~my-npm-package/some/file'"),a(`
  `),n("span",{class:"token punctuation"},"]"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<div class="doc-note doc-note--warning"${t}><p class="doc-note__title"${t}>WARNING</p><p${t}>The order in which you specify the SSR middlewares matters because it determines the way in which the middlewares are applied to the Nodejs server. So they influence how it responds to the client.</p></div><h2 id="the-ssr-render-middleware" class="doc-heading doc-h2"${t}>The SSR render middleware</h2><div class="doc-note doc-note--danger"${t}><p class="doc-note__title"${t}>Important!</p><p${t}>Out of all the possible SSR middlewares in your app, <strong${t}>this one is absolutely required</strong>, because it handles the actual SSR rendering with Vue.</p></div><p${t}>In the example below we highlight that this middleware needs to be the last in the list. This is because it also responds to the client (as we’ll see in the second code sample below) with the HTML of the page. So any subsequent middleware cannot set headers.</p>`),l(u(p(k),{title:"/quasar.config file"},{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token literal-property property"${s}>ssr</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>{</span>
  <span class="token literal-property property"${s}>middlewares</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>[</span>
    <span class="token comment"${s}>// ..... all other middlewares</span>

    <span class="token string"${s}>&#39;render&#39;</span> <span class="token comment"${s}>// references /src-ssr/middlewares/render.js;</span>
             <span class="token comment"${s}>// you can name the file however you want,</span>
             <span class="token comment"${s}>// just make sure that it runs as last middleware</span>
  <span class="token punctuation"${s}>]</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token literal-property property"},"ssr"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"middlewares"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"["),a(`
    `),n("span",{class:"token comment"},"// ..... all other middlewares"),a(`

    `),n("span",{class:"token string"},"'render'"),a(),n("span",{class:"token comment"},"// references /src-ssr/middlewares/render.js;"),a(`
             `),n("span",{class:"token comment"},"// you can name the file however you want,"),a(`
             `),n("span",{class:"token comment"},"// just make sure that it runs as last middleware"),a(`
  `),n("span",{class:"token punctuation"},"]"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<p${t}>Now let’s see what it contains:</p>`),l(u(p(k),{title:"src-ssr/middlewares/render.js"},{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token comment"${s}>// This middleware should execute as last one</span>
<span class="token comment"${s}>// since it captures everything and tries to</span>
<span class="token comment"${s}>// render the page with Vue</span>

<span class="token keyword"${s}>export</span> <span class="token keyword"${s}>default</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}><span class="token punctuation"${s}>{</span> app<span class="token punctuation"${s}>,</span> resolve<span class="token punctuation"${s}>,</span> render<span class="token punctuation"${s}>,</span> serve <span class="token punctuation"${s}>}</span></span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
  <span class="token comment"${s}>// we capture any other Express route and hand it</span>
  <span class="token comment"${s}>// over to Vue and Vue Router to render our page</span>
  app<span class="token punctuation"${s}>.</span><span class="token function"${s}>get</span><span class="token punctuation"${s}>(</span>resolve<span class="token punctuation"${s}>.</span><span class="token function"${s}>urlPath</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;*&#39;</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>,</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}>req<span class="token punctuation"${s}>,</span> res</span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
    res<span class="token punctuation"${s}>.</span><span class="token function"${s}>setHeader</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;Content-Type&#39;</span><span class="token punctuation"${s}>,</span> <span class="token string"${s}>&#39;text/html&#39;</span><span class="token punctuation"${s}>)</span>

    <span class="token function"${s}>render</span><span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>{</span> req<span class="token punctuation"${s}>,</span> res <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
      <span class="token punctuation"${s}>.</span><span class="token function"${s}>then</span><span class="token punctuation"${s}>(</span><span class="token parameter"${s}>html</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
        <span class="token comment"${s}>// now let&#39;s send the rendered html to the client</span>
        res<span class="token punctuation"${s}>.</span><span class="token function"${s}>send</span><span class="token punctuation"${s}>(</span>html<span class="token punctuation"${s}>)</span>
      <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
      <span class="token punctuation"${s}>.</span><span class="token function"${s}>catch</span><span class="token punctuation"${s}>(</span><span class="token parameter"${s}>err</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
        <span class="token comment"${s}>// oops, we had an error while rendering the page</span>

        <span class="token comment"${s}>// we were told to redirect to another URL</span>
        <span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>url<span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span>
          <span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>code<span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span>
            res<span class="token punctuation"${s}>.</span><span class="token function"${s}>redirect</span><span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>code<span class="token punctuation"${s}>,</span> err<span class="token punctuation"${s}>.</span>url<span class="token punctuation"${s}>)</span>
          <span class="token punctuation"${s}>}</span>
          <span class="token keyword"${s}>else</span> <span class="token punctuation"${s}>{</span>
            res<span class="token punctuation"${s}>.</span><span class="token function"${s}>redirect</span><span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>url<span class="token punctuation"${s}>)</span>
          <span class="token punctuation"${s}>}</span>
        <span class="token punctuation"${s}>}</span>
        <span class="token comment"${s}>// hmm, Vue Router could not find the requested route</span>
        <span class="token keyword"${s}>else</span> <span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>code <span class="token operator"${s}>===</span> <span class="token number"${s}>404</span><span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span>
          <span class="token comment"${s}>// Should reach here only if no &quot;catch-all&quot; route</span>
          <span class="token comment"${s}>// is defined in /src/routes</span>
          res<span class="token punctuation"${s}>.</span><span class="token function"${s}>status</span><span class="token punctuation"${s}>(</span><span class="token number"${s}>404</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>.</span><span class="token function"${s}>send</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;404 | Page Not Found&#39;</span><span class="token punctuation"${s}>)</span>
        <span class="token punctuation"${s}>}</span>
        <span class="token comment"${s}>// well, we treat any other code as error;</span>
        <span class="token comment"${s}>// if we&#39;re in dev mode, then we can use Quasar CLI</span>
        <span class="token comment"${s}>// to display a nice error page that contains the stack</span>
        <span class="token comment"${s}>// and other useful information</span>
        <span class="token keyword"${s}>else</span> <span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>process<span class="token punctuation"${s}>.</span>env<span class="token punctuation"${s}>.</span><span class="token constant"${s}>DEV</span><span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span>
          <span class="token comment"${s}>// serve.error is available on dev only</span>
          serve<span class="token punctuation"${s}>.</span><span class="token function"${s}>error</span><span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>{</span> err<span class="token punctuation"${s}>,</span> req<span class="token punctuation"${s}>,</span> res <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
        <span class="token punctuation"${s}>}</span>
        <span class="token comment"${s}>// we&#39;re in production, so we should have another method</span>
        <span class="token comment"${s}>// to display something to the client when we encounter an error</span>
        <span class="token comment"${s}>// (for security reasons, it&#39;s not ok to display the same wealth</span>
        <span class="token comment"${s}>// of information as we do in development)</span>
        <span class="token keyword"${s}>else</span> <span class="token punctuation"${s}>{</span>
          <span class="token comment"${s}>// Render Error Page on production or</span>
          <span class="token comment"${s}>// create a route (/src/routes) for an error page and redirect to it</span>
          res<span class="token punctuation"${s}>.</span><span class="token function"${s}>status</span><span class="token punctuation"${s}>(</span><span class="token number"${s}>500</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>.</span><span class="token function"${s}>send</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;500 | Internal Server Error&#39;</span><span class="token punctuation"${s}>)</span>
          <span class="token comment"${s}>// console.error(err.stack)</span>
        <span class="token punctuation"${s}>}</span>
      <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
  <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// This middleware should execute as last one"),a(`
`),n("span",{class:"token comment"},"// since it captures everything and tries to"),a(`
`),n("span",{class:"token comment"},"// render the page with Vue"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},"// we capture any other Express route and hand it"),a(`
  `),n("span",{class:"token comment"},"// over to Vue and Vue Router to render our page"),a(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'*'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[a("req"),n("span",{class:"token punctuation"},","),a(" res")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
    res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setHeader"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Content-Type'"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token string"},"'text/html'"),n("span",{class:"token punctuation"},")"),a(`

    `),n("span",{class:"token function"},"render"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"then"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"html"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
        `),n("span",{class:"token comment"},"// now let's send the rendered html to the client"),a(`
        res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),a("html"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"catch"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"err"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
        `),n("span",{class:"token comment"},"// oops, we had an error while rendering the page"),a(`

        `),n("span",{class:"token comment"},"// we were told to redirect to another URL"),a(`
        `),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code"),n("span",{class:"token punctuation"},","),a(" err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token punctuation"},"}"),a(`
          `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// hmm, Vue Router could not find the requested route"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code "),n("span",{class:"token operator"},"==="),a(),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},'// Should reach here only if no "catch-all" route'),a(`
          `),n("span",{class:"token comment"},"// is defined in /src/routes"),a(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'404 | Page Not Found'"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// well, we treat any other code as error;"),a(`
        `),n("span",{class:"token comment"},"// if we're in dev mode, then we can use Quasar CLI"),a(`
        `),n("span",{class:"token comment"},"// to display a nice error page that contains the stack"),a(`
        `),n("span",{class:"token comment"},"// and other useful information"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("process"),n("span",{class:"token punctuation"},"."),a("env"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"DEV"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},"// serve.error is available on dev only"),a(`
          serve`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" err"),n("span",{class:"token punctuation"},","),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// we're in production, so we should have another method"),a(`
        `),n("span",{class:"token comment"},"// to display something to the client when we encounter an error"),a(`
        `),n("span",{class:"token comment"},"// (for security reasons, it's not ok to display the same wealth"),a(`
        `),n("span",{class:"token comment"},"// of information as we do in development)"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},"// Render Error Page on production or"),a(`
          `),n("span",{class:"token comment"},"// create a route (/src/routes) for an error page and redirect to it"),a(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'500 | Internal Server Error'"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token comment"},"// console.error(err.stack)"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t)),l(`<p${t}>Notice the <code class="doc-token"${t}>render</code> parameter (from the above code sample) that the exported function of the middleware gets called with. That’s where the SSR rendering happens.</p><h2 id="hot-module-reload" class="doc-heading doc-h2"${t}>Hot Module Reload</h2><p${t}>While developing, whenever you change anything in the SSR middlewares, Quasar App CLI will automatically trigger a recompilation of client-side resources and apply the middleware changes to the Nodejs server (Expressjs).</p><h2 id="examples-of-ssr-middleware" class="doc-heading doc-h2"${t}>Examples of SSR middleware</h2><div class="doc-note doc-note--tip"${t}><p class="doc-note__title"${t}>TIP</p><p${t}>You can use any connect API compatible middleware.</p></div><h3 id="logger-interceptor" class="doc-heading doc-h3"${t}>Logger / Interceptor</h3><p${t}>The order in which the SSR middlewares are applied matters. So it might be wise to set the following one as the first (in quasar.config file &gt; ssr &gt; middlewares) so that it will be able to intercept all client requests.</p>`),l(u(p(k),null,{default:c((i,e,r,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token keyword"${s}>export</span> <span class="token keyword"${s}>default</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}><span class="token punctuation"${s}>{</span> app<span class="token punctuation"${s}>,</span> resolve <span class="token punctuation"${s}>}</span></span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
  app<span class="token punctuation"${s}>.</span><span class="token function"${s}>all</span><span class="token punctuation"${s}>(</span>resolve<span class="token punctuation"${s}>.</span><span class="token function"${s}>urlPath</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;*&#39;</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>,</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}>req<span class="token punctuation"${s}>,</span> _<span class="token punctuation"${s}>,</span> next</span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
    console<span class="token punctuation"${s}>.</span><span class="token function"${s}>log</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;someone requested:&#39;</span><span class="token punctuation"${s}>,</span> req<span class="token punctuation"${s}>.</span>url<span class="token punctuation"${s}>)</span>
    <span class="token function"${s}>next</span><span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>)</span>
  <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(u(o,null,null,r,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" resolve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"all"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'*'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[a("req"),n("span",{class:"token punctuation"},","),a(" _"),n("span",{class:"token punctuation"},","),a(" next")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
    console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'someone requested:'"),n("span",{class:"token punctuation"},","),a(" req"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
    `),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},d,t));else return[n("p",null,"The SSR middleware files fulfill one special purpose: they prepare the Nodejs server that runs your SSR app with additional functionality (Expressjs compatible middleware)."),n("p",null,[a("With SSR middleware files, it is possible to split the middleware logic into self-contained, easy to maintain files. It is also trivial to disable any of the SSR middleware files or even contextually determine which of the SSR middleware files get into the build through the "),n("code",{class:"doc-token"},"/quasar.config"),a(" file configuration.")]),n("div",{class:"doc-note doc-note--tip"},[n("p",{class:"doc-note__title"},"TIP"),n("p",null,[a("For more advanced usage, you will need to get acquainted to the "),n(f,{to:"https://expressjs.com/en/4x/api.html"},{default:c(()=>[a("Expressjs API")]),_:1}),a(".")])]),n("div",{class:"doc-note doc-note--warning"},[n("p",{class:"doc-note__title"},"WARNING"),n("p",null,[a("You will need at least one SSR middleware file which handles the rendering of the page with Vue (which should be positioned as last in the middlewares list). When SSR mode is added to your Quasar CLI project, this will be scaffolded into "),n("code",{class:"doc-token"},"src-ssr/middlewares/render.js"),a(".")])]),n("h2",{id:"anatomy-of-a-middleware-file",class:"doc-heading doc-h2",onClick:i=>p(m)("anatomy-of-a-middleware-file")},"Anatomy of a middleware file",8,["onClick"]),n("p",null,"A SSR middleware file is a simple JavaScript file which exports a function. Quasar will then call the exported function when it prepares the Nodejs server (Expressjs) app and additionally pass an Object as param (which will be detailed in the next section)."),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// import something here"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},'// something to do with the server "app"'),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("p",null,"The SSR middleware files can also be async:"),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// import something here"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token keyword"},"async"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},'// something to do with the server "app"'),a(`
  `),n("span",{class:"token keyword"},"await"),a(),n("span",{class:"token function"},"something"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("p",null,[a("You can wrap the returned function with "),n("code",{class:"doc-token"},"ssrMiddleware"),a(" helper to get a better IDE autocomplete experience (through Typescript):")]),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"import"),a(),n("span",{class:"token punctuation"},"{"),a(" ssrMiddleware "),n("span",{class:"token punctuation"},"}"),a(),n("span",{class:"token keyword"},"from"),a(),n("span",{class:"token string"},"'quasar/wrappers'"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token function"},"ssrMiddleware"),n("span",{class:"token punctuation"},"("),n("span",{class:"token keyword"},"async"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},"// something to do"),a(`
  `),n("span",{class:"token keyword"},"await"),a(),n("span",{class:"token function"},"something"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")])]),n(o)]),_:1}),n("p",null,[a("Notice we are using the "),n(f,{to:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment"},{default:c(()=>[a("ES6 destructuring assignment")]),_:1}),a(". Only assign what you actually need/use.")]),n("h2",{id:"middleware-object-parameter",class:"doc-heading doc-h2",onClick:i=>p(m)("middleware-object-parameter")},"Middleware object parameter",8,["onClick"]),n("p",null,"We are referring here to the Object received as parameter by the default exported function of the SSR middleware file."),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{")])]),n(o)]),_:1}),n("p",null,"Detailing the Object:"),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token punctuation"},"{"),a(`
  app`),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token comment"},"// Node.js app instance"),a(`
  port`),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token comment"},"// Nodej.js webserver configured port"),a(`
  `),n("span",{class:"token literal-property property"},"resolve"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
    `),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),a("path"),n("span",{class:"token punctuation"},")"),a(`
    `),n("span",{class:"token function"},"root"),n("span",{class:"token punctuation"},"("),a("arg1"),n("span",{class:"token punctuation"},","),a(" arg2"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(`
    `),n("span",{class:"token keyword"},"public"),n("span",{class:"token punctuation"},"("),a("arg1"),n("span",{class:"token punctuation"},","),a(" arg2"),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),a(`
  publicPath`),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token comment"},"// String"),a(`
  `),n("span",{class:"token literal-property property"},"folders"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
    root`),n("span",{class:"token punctuation"},","),a("     "),n("span",{class:"token comment"},"// String"),a(`
    `),n("span",{class:"token keyword"},"public"),a("    "),n("span",{class:"token comment"},"// String"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},","),a(`
  `),n("span",{class:"token function"},"render"),n("span",{class:"token punctuation"},"("),a("ssrContext"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(`
  `),n("span",{class:"token literal-property property"},"serve"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
    `),n("span",{class:"token keyword"},"static"),n("span",{class:"token punctuation"},"("),a("path"),n("span",{class:"token punctuation"},","),a(" opts"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(`
    `),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" err"),n("span",{class:"token punctuation"},","),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("h4",{id:"app",class:"doc-heading doc-h4",onClick:i=>p(m)("app")},"app",8,["onClick"]),n("p",null,"This is the Node.js app instance. The “bread and butter” of any middleware since you’ll be using it to configure the webserver."),n("h4",{id:"port",class:"doc-heading doc-h4",onClick:i=>p(m)("port")},"port",8,["onClick"]),n("p",null,"The configured port for the Node.js webserver."),n("h4",{id:"resolve",class:"doc-heading doc-h4",onClick:i=>p(m)("resolve")},"resolve",8,["onClick"]),n($,{class:"doc-page-table","wrap-cells":!0,flat:!0,bordered:!0},{default:c(()=>[n("thead",null,[n("tr",null,[n("th",{class:"text-left"},"Prop name"),n("th",{class:"text-left"},"Description")])]),n("tbody",null,[n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"urlPath(path)")]),n("td",null,[a("Whenever you define a route (with app.use(), app.get(), app.post() etc), you should use the "),n("code",{class:"doc-token"},"resolve.urlPath()"),a(" method so that you’ll also keep into account the configured publicPath (quasar.config file > build > publicPath).")])]),n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"root(path1[, path2, ...pathN])")]),n("td",null,[a("Resolve folder path to the root (of the project in dev and of the distributables in production). Under the hood, it does a "),n("code",{class:"doc-token"},"path.join()"),a(".")])]),n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"public(path1[, path2, ...pathN])")]),n("td",null,[a("Resolve folder path to the “public” folder. Under the hood, it does a "),n("code",{class:"doc-token"},"path.join()"),a(".")])])])]),_:1}),n("h4",{id:"publicpath",class:"doc-heading doc-h4",onClick:i=>p(m)("publicpath")},"publicPath",8,["onClick"]),n("p",null,"The configured quasar.config file > build > publicPath"),n("h4",{id:"folders",class:"doc-heading doc-h4",onClick:i=>p(m)("folders")},"folders",8,["onClick"]),n("p",null,[a("The "),n("code",{class:"doc-token"},"folders"),a(" is sometimes needed because the exact path to root folder and to the public folder differs in a production build than in a development build. So by using "),n("code",{class:"doc-token"},"folders"),a(" you won’t need to mind about this.")]),n($,{class:"doc-page-table","wrap-cells":!0,flat:!0,bordered:!0},{default:c(()=>[n("thead",null,[n("tr",null,[n("th",{class:"text-left"},"Prop name"),n("th",{class:"text-left"},"Description")])]),n("tbody",null,[n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"root")]),n("td",null,"Full path to the root (of the project in dev and of the distributables in production).")]),n("tr",null,[n("td",null,[n("code",{class:"doc-token"},"public")]),n("td",null,"Full path to the “public” folder.")])])]),_:1}),n("h4",{id:"render",class:"doc-heading doc-h4",onClick:i=>p(m)("render")},"render",8,["onClick"]),n("ul",null,[n("li",null,[a("Syntax: "),n("code",{class:"doc-token"},"<Promise(String)> render(ssrContext)"),a(".")]),n("li",null,"Description: Uses Vue and Vue Router to render the requested URL path. Returns the rendered HTML string to return to the client.")]),n("h4",{id:"serve",class:"doc-heading doc-h4",onClick:i=>p(m)("serve")},"serve",8,["onClick"]),n("p",null,"serve.static():"),n("ul",null,[n("li",null,[n("p",null,[a("Syntax: "),n("code",{class:"doc-token"},"<middlewareFn> serve.static(pathFromPublicFolder, opts)")])]),n("li",null,[n("p",null,[a("Description: It’s essentially a wrapper over "),n("code",{class:"doc-token"},"express.static()"),a(" with a few convenient tweaks:")]),n("ul",null,[n("li",null,[a("the "),n("code",{class:"doc-token"},"pathFromPublicFolder"),a(" is a path resolved to the “public” folder out of the box")]),n("li",null,[a("the "),n("code",{class:"doc-token"},"opts"),a(" are the same as for "),n("code",{class:"doc-token"},"express.static()")]),n("li",null,[n("code",{class:"doc-token"},"opts.maxAge"),a(" is used by default, taking into account the quasar.config file > ssr > maxAge configuration; this sets how long the respective file(s) can live in browser’s cache")])]),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[a("serve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"static"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'my-file.json'"),n("span",{class:"token punctuation"},")"),a(`

`),n("span",{class:"token comment"},"// is equivalent to:"),a(`

express`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"static"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"public"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'my-file.json'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"maxAge"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token operator"},"..."),a(),n("span",{class:"token comment"},"// quasar.config file > ssr > maxAge"),a(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")])]),n(o)]),_:1})])]),n("p",null,"serve.error():"),n("ul",null,[n("li",null,[a("Syntax: "),n("code",{class:"doc-token"},"<void> serve.error({ err, req, res })")]),n("li",null,"Description: Displays a wealth of useful debug information (including the stack trace)."),n("li",null,[a("It’s available only in development and "),n("strong",null,"NOT in production"),a(".")])]),n("h2",{id:"usage-of-ssr-middleware",class:"doc-heading doc-h2",onClick:i=>p(m)("usage-of-ssr-middleware")},"Usage of SSR middleware",8,["onClick"]),n("p",null,"The first step is always to generate a new SSR middleware file using Quasar CLI:"),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[a("$ quasar new ssrmiddleware "),n("span",{class:"token operator"},"<"),a("name"),n("span",{class:"token operator"},">")])]),n(o,{lang:"bash"})]),_:1}),n("p",null,[a("Where "),n("code",{class:"doc-token"},"<name>"),a(" should be exchanged by a suitable name for your SSR middleware file.")]),n("p",null,[a("This command creates a new file: "),n("code",{class:"doc-token"},"/src-ssr/middlewares/<name>.js"),a(" with the following content:")]),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// import something here"),a(`

`),n("span",{class:"token comment"},'// "async" is optional!'),a(`
`),n("span",{class:"token comment"},"// remove it if you don't need it"),a(`
`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token keyword"},"async"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolveUrlPath"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},'// something to do with the server "app"'),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("p",null,"You can also return a Promise:"),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// import something here"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" port"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" publicPath"),n("span",{class:"token punctuation"},","),a(" folders"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token keyword"},"return"),a(),n("span",{class:"token keyword"},"new"),a(),n("span",{class:"token class-name"},"Promise"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[a("resolve"),n("span",{class:"token punctuation"},","),a(" reject")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
    `),n("span",{class:"token comment"},'// something to do with the server "app"'),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("p",null,"You can now add content to that file depending on the intended use of your SSR middleware file."),n("p",null,[a("The last step is to tell Quasar to use your new SSR middleware file. For this to happen you need to add the file in the "),n("code",{class:"doc-token"},"/quasar.config"),a(" file:")]),n(p(k),{title:"/quasar.config file"},{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token literal-property property"},"ssr"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"middlewares"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"["),a(`
    `),n("span",{class:"token comment"},"// references /src-ssr/middlewares/<name>.js"),a(`
    `),n("span",{class:"token string"},"'<name>'"),a(`
  `),n("span",{class:"token punctuation"},"]"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("p",null,"When building a SSR app, you may want some boot files to run only on production or only on development, in which case you can do so like below:"),n(p(k),{title:"/quasar.config file"},{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token literal-property property"},"ssr"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"middlewares"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"["),a(`
    ctx`),n("span",{class:"token punctuation"},"."),a("prod "),n("span",{class:"token operator"},"?"),a(),n("span",{class:"token string"},"'<name>'"),a(),n("span",{class:"token operator"},":"),a(),n("span",{class:"token string"},"''"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token comment"},"// I run only on production!"),a(`
    ctx`),n("span",{class:"token punctuation"},"."),a("dev "),n("span",{class:"token operator"},"?"),a(),n("span",{class:"token string"},"'<name>'"),a(),n("span",{class:"token operator"},":"),a(),n("span",{class:"token string"},"''"),a(),n("span",{class:"token comment"},"// I run only on development"),a(`
  `),n("span",{class:"token punctuation"},"]"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("p",null,[a("In case you want to specify SSR middleware file from node_modules, you can do so by prepending the path with "),n("code",{class:"doc-token"},"~"),a(" (tilde) character:")]),n(p(k),{title:"/quasar.config file"},{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token literal-property property"},"ssr"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"middlewares"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"["),a(`
    `),n("span",{class:"token comment"},"// boot file from an npm package"),a(`
    `),n("span",{class:"token string"},"'~my-npm-package/some/file'"),a(`
  `),n("span",{class:"token punctuation"},"]"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("div",{class:"doc-note doc-note--warning"},[n("p",{class:"doc-note__title"},"WARNING"),n("p",null,"The order in which you specify the SSR middlewares matters because it determines the way in which the middlewares are applied to the Nodejs server. So they influence how it responds to the client.")]),n("h2",{id:"the-ssr-render-middleware",class:"doc-heading doc-h2",onClick:i=>p(m)("the-ssr-render-middleware")},"The SSR render middleware",8,["onClick"]),n("div",{class:"doc-note doc-note--danger"},[n("p",{class:"doc-note__title"},"Important!"),n("p",null,[a("Out of all the possible SSR middlewares in your app, "),n("strong",null,"this one is absolutely required"),a(", because it handles the actual SSR rendering with Vue.")])]),n("p",null,"In the example below we highlight that this middleware needs to be the last in the list. This is because it also responds to the client (as we’ll see in the second code sample below) with the HTML of the page. So any subsequent middleware cannot set headers."),n(p(k),{title:"/quasar.config file"},{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token literal-property property"},"ssr"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token literal-property property"},"middlewares"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"["),a(`
    `),n("span",{class:"token comment"},"// ..... all other middlewares"),a(`

    `),n("span",{class:"token string"},"'render'"),a(),n("span",{class:"token comment"},"// references /src-ssr/middlewares/render.js;"),a(`
             `),n("span",{class:"token comment"},"// you can name the file however you want,"),a(`
             `),n("span",{class:"token comment"},"// just make sure that it runs as last middleware"),a(`
  `),n("span",{class:"token punctuation"},"]"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("p",null,"Now let’s see what it contains:"),n(p(k),{title:"src-ssr/middlewares/render.js"},{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// This middleware should execute as last one"),a(`
`),n("span",{class:"token comment"},"// since it captures everything and tries to"),a(`
`),n("span",{class:"token comment"},"// render the page with Vue"),a(`

`),n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},"// we capture any other Express route and hand it"),a(`
  `),n("span",{class:"token comment"},"// over to Vue and Vue Router to render our page"),a(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'*'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[a("req"),n("span",{class:"token punctuation"},","),a(" res")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
    res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setHeader"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Content-Type'"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token string"},"'text/html'"),n("span",{class:"token punctuation"},")"),a(`

    `),n("span",{class:"token function"},"render"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"then"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"html"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
        `),n("span",{class:"token comment"},"// now let's send the rendered html to the client"),a(`
        res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),a("html"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"catch"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"err"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
        `),n("span",{class:"token comment"},"// oops, we had an error while rendering the page"),a(`

        `),n("span",{class:"token comment"},"// we were told to redirect to another URL"),a(`
        `),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code"),n("span",{class:"token punctuation"},","),a(" err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token punctuation"},"}"),a(`
          `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// hmm, Vue Router could not find the requested route"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code "),n("span",{class:"token operator"},"==="),a(),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},'// Should reach here only if no "catch-all" route'),a(`
          `),n("span",{class:"token comment"},"// is defined in /src/routes"),a(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'404 | Page Not Found'"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// well, we treat any other code as error;"),a(`
        `),n("span",{class:"token comment"},"// if we're in dev mode, then we can use Quasar CLI"),a(`
        `),n("span",{class:"token comment"},"// to display a nice error page that contains the stack"),a(`
        `),n("span",{class:"token comment"},"// and other useful information"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("process"),n("span",{class:"token punctuation"},"."),a("env"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"DEV"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},"// serve.error is available on dev only"),a(`
          serve`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" err"),n("span",{class:"token punctuation"},","),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// we're in production, so we should have another method"),a(`
        `),n("span",{class:"token comment"},"// to display something to the client when we encounter an error"),a(`
        `),n("span",{class:"token comment"},"// (for security reasons, it's not ok to display the same wealth"),a(`
        `),n("span",{class:"token comment"},"// of information as we do in development)"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},"// Render Error Page on production or"),a(`
          `),n("span",{class:"token comment"},"// create a route (/src/routes) for an error page and redirect to it"),a(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'500 | Internal Server Error'"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token comment"},"// console.error(err.stack)"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("p",null,[a("Notice the "),n("code",{class:"doc-token"},"render"),a(" parameter (from the above code sample) that the exported function of the middleware gets called with. That’s where the SSR rendering happens.")]),n("h2",{id:"hot-module-reload",class:"doc-heading doc-h2",onClick:i=>p(m)("hot-module-reload")},"Hot Module Reload",8,["onClick"]),n("p",null,"While developing, whenever you change anything in the SSR middlewares, Quasar App CLI will automatically trigger a recompilation of client-side resources and apply the middleware changes to the Nodejs server (Expressjs)."),n("h2",{id:"examples-of-ssr-middleware",class:"doc-heading doc-h2",onClick:i=>p(m)("examples-of-ssr-middleware")},"Examples of SSR middleware",8,["onClick"]),n("div",{class:"doc-note doc-note--tip"},[n("p",{class:"doc-note__title"},"TIP"),n("p",null,"You can use any connect API compatible middleware.")]),n("h3",{id:"logger-interceptor",class:"doc-heading doc-h3",onClick:i=>p(m)("logger-interceptor")},"Logger / Interceptor",8,["onClick"]),n("p",null,"The order in which the SSR middlewares are applied matters. So it might be wise to set the following one as the first (in quasar.config file > ssr > middlewares) so that it will be able to intercept all client requests."),n(p(k),null,{default:c(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" resolve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"all"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'*'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[a("req"),n("span",{class:"token punctuation"},","),a(" _"),n("span",{class:"token punctuation"},","),a(" next")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
    console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'someone requested:'"),n("span",{class:"token punctuation"},","),a(" req"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
    `),n("span",{class:"token function"},"next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1})]}),_:1},S))}}},v=g.setup;g.setup=(y,w)=>{const h=P();return(h.modules||(h.modules=new Set)).add("src/pages/quasar-cli-vite/developing-ssr/ssr-middleware.md"),v?v(y,w):void 0};const J=C(g,[["__file","ssr-middleware.md"]]);export{J as default};
