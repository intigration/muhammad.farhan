import{mergeProps as E,withCtx as u,unref as p,createVNode as n,createTextVNode as a,useSSRContext as R}from"vue";import{ssrRenderComponent as l}from"vue/server-renderer";import{c as f}from"./page-utils-C-QWsEHe.js";import{D as V}from"./DocPage-DKr-0pQn.js";import{D as r}from"./DocPrerender-DPOnWPFO.js";import{C as o}from"./CopyButton-l3ndfN49.js";import{_ as x}from"../server-entry.js";import"quasar";import"@quasar/extras/mdi-v6";import"vue-router";import"@quasar/extras/fontawesome-v5";import"@quasar/extras/fontawesome-v6";import"@quasar/extras/mdi-v7";import"quasar/icon-set/svg-mdi-v6.mjs";const d={__name:"handling-404-and-500-errors",__ssrInlineRender:!0,setup(w){const $=[{id:"things-to-be-aware-of",title:"2. Things to be aware of"},{id:"error-404",title:"2.1. Error 404",sub:!0},{id:"error-500",title:"2.2. Error 500",sub:!0}];return(h,y,v,b)=>{y(l(V,E({title:"SSR Handling of 404 and 500 Errors",desc:"(@quasar/app-webpack) Managing the common 404 and 500 HTTP errors in a Quasar server-side rendered app.",overline:"Quasar CLI with Webpack - @quasar/app-webpack",heading:"","edit-link":"quasar-cli-webpack/developing-ssr/handling-404-and-500-errors",toc:$},b),{default:u((q,c,m,t)=>{if(c)c(`<p${t}>The handling of the 404 &amp; 500 errors on SSR is a bit different than on the other modes (like SPA). If you check out <code class="doc-token"${t}>/src-ssr/middlewares/render.js</code>, you will notice the following section:</p>`),c(l(p(r),null,{default:u((k,e,i,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token keyword"${s}>export</span> <span class="token keyword"${s}>default</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}><span class="token punctuation"${s}>{</span> app<span class="token punctuation"${s}>,</span> resolve<span class="token punctuation"${s}>,</span> render<span class="token punctuation"${s}>,</span> serve <span class="token punctuation"${s}>}</span></span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
  <span class="token comment"${s}>// we capture any other Express route and hand it</span>
  <span class="token comment"${s}>// over to Vue and Vue Router to render our page</span>
  app<span class="token punctuation"${s}>.</span><span class="token function"${s}>get</span><span class="token punctuation"${s}>(</span>resolve<span class="token punctuation"${s}>.</span><span class="token function"${s}>urlPath</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;*&#39;</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>,</span> <span class="token punctuation"${s}>(</span><span class="token parameter"${s}>req<span class="token punctuation"${s}>,</span> res</span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
    res<span class="token punctuation"${s}>.</span><span class="token function"${s}>setHeader</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;Content-Type&#39;</span><span class="token punctuation"${s}>,</span> <span class="token string"${s}>&#39;text/html&#39;</span><span class="token punctuation"${s}>)</span>

    <span class="token function"${s}>render</span><span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>{</span> req<span class="token punctuation"${s}>,</span> res <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
      <span class="token punctuation"${s}>.</span><span class="token function"${s}>then</span><span class="token punctuation"${s}>(</span><span class="token parameter"${s}>html</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
        <span class="token comment"${s}>// now let&#39;s send the rendered html to the client</span>
        res<span class="token punctuation"${s}>.</span><span class="token function"${s}>send</span><span class="token punctuation"${s}>(</span>html<span class="token punctuation"${s}>)</span>
      <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
      <span class="token punctuation"${s}>.</span><span class="token function"${s}>catch</span><span class="token punctuation"${s}>(</span><span class="token parameter"${s}>err</span> <span class="token operator"${s}>=&gt;</span> <span class="token punctuation"${s}>{</span>
        <span class="token comment"${s}>// oops, we had an error while rendering the page</span>

        <span class="token comment"${s}>// we were told to redirect to another URL</span>
        <span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>url<span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span>
          <span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>code<span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span>
            res<span class="token punctuation"${s}>.</span><span class="token function"${s}>redirect</span><span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>code<span class="token punctuation"${s}>,</span> err<span class="token punctuation"${s}>.</span>url<span class="token punctuation"${s}>)</span>
          <span class="token punctuation"${s}>}</span>
          <span class="token keyword"${s}>else</span> <span class="token punctuation"${s}>{</span>
            res<span class="token punctuation"${s}>.</span><span class="token function"${s}>redirect</span><span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>url<span class="token punctuation"${s}>)</span>
          <span class="token punctuation"${s}>}</span>
        <span class="token punctuation"${s}>}</span>
        <span class="token comment"${s}>// hmm, Vue Router could not find the requested route</span>
        <span class="token keyword"${s}>else</span> <span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>code <span class="token operator"${s}>===</span> <span class="token number"${s}>404</span><span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span>
          <span class="token comment"${s}>// Should reach here only if no &quot;catch-all&quot; route</span>
          <span class="token comment"${s}>// is defined in /src/routes</span>
          res<span class="token punctuation"${s}>.</span><span class="token function"${s}>status</span><span class="token punctuation"${s}>(</span><span class="token number"${s}>404</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>.</span><span class="token function"${s}>send</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;404 | Page Not Found&#39;</span><span class="token punctuation"${s}>)</span>
        <span class="token punctuation"${s}>}</span>
        <span class="token comment"${s}>// well, we treat any other code as error;</span>
        <span class="token comment"${s}>// if we&#39;re in dev mode, then we can use Quasar CLI</span>
        <span class="token comment"${s}>// to display a nice error page that contains the stack</span>
        <span class="token comment"${s}>// and other useful information</span>
        <span class="token keyword"${s}>else</span> <span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>process<span class="token punctuation"${s}>.</span>env<span class="token punctuation"${s}>.</span><span class="token constant"${s}>DEV</span><span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span>
          <span class="token comment"${s}>// serve.error is available on dev only</span>
          serve<span class="token punctuation"${s}>.</span><span class="token function"${s}>error</span><span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>{</span> err<span class="token punctuation"${s}>,</span> req<span class="token punctuation"${s}>,</span> res <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
        <span class="token punctuation"${s}>}</span>
        <span class="token comment"${s}>// we&#39;re in production, so we should have another method</span>
        <span class="token comment"${s}>// to display something to the client when we encounter an error</span>
        <span class="token comment"${s}>// (for security reasons, it&#39;s not ok to display the same wealth</span>
        <span class="token comment"${s}>// of information as we do in development)</span>
        <span class="token keyword"${s}>else</span> <span class="token punctuation"${s}>{</span>
          <span class="token comment"${s}>// Render Error Page on production or</span>
          <span class="token comment"${s}>// create a route (/src/routes) for an error page and redirect to it</span>
          res<span class="token punctuation"${s}>.</span><span class="token function"${s}>status</span><span class="token punctuation"${s}>(</span><span class="token number"${s}>500</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>.</span><span class="token function"${s}>send</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;500 | Internal Server Error&#39;</span><span class="token punctuation"${s}>)</span>
        <span class="token punctuation"${s}>}</span>
      <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
  <span class="token punctuation"${s}>}</span><span class="token punctuation"${s}>)</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(l(o,null,null,i,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},"// we capture any other Express route and hand it"),a(`
  `),n("span",{class:"token comment"},"// over to Vue and Vue Router to render our page"),a(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'*'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[a("req"),n("span",{class:"token punctuation"},","),a(" res")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
    res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setHeader"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Content-Type'"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token string"},"'text/html'"),n("span",{class:"token punctuation"},")"),a(`

    `),n("span",{class:"token function"},"render"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"then"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"html"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
        `),n("span",{class:"token comment"},"// now let's send the rendered html to the client"),a(`
        res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),a("html"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"catch"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"err"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
        `),n("span",{class:"token comment"},"// oops, we had an error while rendering the page"),a(`

        `),n("span",{class:"token comment"},"// we were told to redirect to another URL"),a(`
        `),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code"),n("span",{class:"token punctuation"},","),a(" err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token punctuation"},"}"),a(`
          `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// hmm, Vue Router could not find the requested route"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code "),n("span",{class:"token operator"},"==="),a(),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},'// Should reach here only if no "catch-all" route'),a(`
          `),n("span",{class:"token comment"},"// is defined in /src/routes"),a(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'404 | Page Not Found'"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// well, we treat any other code as error;"),a(`
        `),n("span",{class:"token comment"},"// if we're in dev mode, then we can use Quasar CLI"),a(`
        `),n("span",{class:"token comment"},"// to display a nice error page that contains the stack"),a(`
        `),n("span",{class:"token comment"},"// and other useful information"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("process"),n("span",{class:"token punctuation"},"."),a("env"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"DEV"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},"// serve.error is available on dev only"),a(`
          serve`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" err"),n("span",{class:"token punctuation"},","),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// we're in production, so we should have another method"),a(`
        `),n("span",{class:"token comment"},"// to display something to the client when we encounter an error"),a(`
        `),n("span",{class:"token comment"},"// (for security reasons, it's not ok to display the same wealth"),a(`
        `),n("span",{class:"token comment"},"// of information as we do in development)"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},"// Render Error Page on production or"),a(`
          `),n("span",{class:"token comment"},"// create a route (/src/routes) for an error page and redirect to it"),a(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'500 | Internal Server Error'"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},m,t)),c(`<p${t}>The section above is written after catching the other possible requests (like for /public folder, the manifest.json and service worker, etc). This is where we render the page with Vue and Vue Router.</p><h2 id="things-to-be-aware-of" class="doc-heading doc-h2"${t}>Things to be aware of</h2><p${t}>We’ll discuss some architectural decisions that you need to be aware of. Choose whatever fits your app best.</p><h3 id="error-404" class="doc-heading doc-h3"${t}>Error 404</h3><p${t}>If you define an equivalent 404 route on your Vue Router <code class="doc-token"${t}>/src/router/routes.js</code> file (like below), then <code class="doc-token"${t}>if (err.code === 404) {</code> part from the example above will NEVER be <code class="doc-token"${t}>true</code> since Vue Router already handled it.</p>`),c(l(p(r),null,{default:u((k,e,i,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token comment"${s}>// Example of route for catching 404 with Vue Router</span>
<span class="token punctuation"${s}>{</span> <span class="token literal-property property"${s}>path</span><span class="token operator"${s}>:</span> <span class="token string"${s}>&#39;/:catchAll(.*)*&#39;</span><span class="token punctuation"${s}>,</span> <span class="token function-variable function"${s}>component</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token keyword"${s}>import</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;pages/Error404.vue&#39;</span><span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>}</span></code></pre>`),e(l(o,null,null,i,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// Example of route for catching 404 with Vue Router"),a(`
`),n("span",{class:"token punctuation"},"{"),a(),n("span",{class:"token literal-property property"},"path"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token string"},"'/:catchAll(.*)*'"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token function-variable function"},"component"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token keyword"},"import"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'pages/Error404.vue'"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},m,t)),c(`<h3 id="error-500" class="doc-heading doc-h3"${t}>Error 500</h3><p${t}>On the <code class="doc-token"${t}>/src-ssr/middlewares/render.js</code> example at the top of the page, notice that if the webserver encounters any rendering error, we send a simple string back to the client (‘500 | Internal Server Error’). If you want to show a nice page instead, you could:</p><ol${t}><li${t}>Add a specific route in <code class="doc-token"${t}>/src/router/routes.js</code>, like:</li></ol>`),c(l(p(r),null,{default:u((k,e,i,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token punctuation"${s}>{</span> <span class="token literal-property property"${s}>path</span><span class="token operator"${s}>:</span> <span class="token string"${s}>&#39;error500&#39;</span><span class="token punctuation"${s}>,</span> <span class="token function-variable function"${s}>component</span><span class="token operator"${s}>:</span> <span class="token punctuation"${s}>(</span><span class="token punctuation"${s}>)</span> <span class="token operator"${s}>=&gt;</span> <span class="token keyword"${s}>import</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;pages/Error500.vue&#39;</span><span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>}</span></code></pre>`),e(l(o,null,null,i,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token punctuation"},"{"),a(),n("span",{class:"token literal-property property"},"path"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token string"},"'error500'"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token function-variable function"},"component"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token keyword"},"import"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'pages/Error500.vue'"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},m,t)),c(`<ol start="2"${t}><li${t}>Write the Vue component to handle this page. In this example, we create <code class="doc-token"${t}>/src/pages/Error500.vue</code></li><li${t}>Then in <code class="doc-token"${t}>/src-ssr/middlewares/render.js</code>:</li></ol>`),c(l(p(r),null,{default:u((k,e,i,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}><span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>url<span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span> <span class="token operator"${s}>...</span> <span class="token punctuation"${s}>}</span>
<span class="token keyword"${s}>else</span> <span class="token keyword"${s}>if</span> <span class="token punctuation"${s}>(</span>err<span class="token punctuation"${s}>.</span>code <span class="token operator"${s}>===</span> <span class="token number"${s}>404</span><span class="token punctuation"${s}>)</span> <span class="token punctuation"${s}>{</span> <span class="token operator"${s}>...</span> <span class="token punctuation"${s}>}</span>
<span class="token keyword"${s}>else</span> <span class="token punctuation"${s}>{</span>
  <span class="token comment"${s}>// We got a 500 error here;</span>
  <span class="token comment"${s}>// We redirect to our &quot;error500&quot; route newly defined at step #1.</span>
  res<span class="token punctuation"${s}>.</span><span class="token function"${s}>redirect</span><span class="token punctuation"${s}>(</span>resolve<span class="token punctuation"${s}>.</span><span class="token function"${s}>urlPath</span><span class="token punctuation"${s}>(</span><span class="token string"${s}>&#39;error500&#39;</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>)</span> <span class="token comment"${s}>// keep account of publicPath though!</span>
<span class="token punctuation"${s}>}</span></code></pre>`),e(l(o,null,null,i,s));else return[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(),n("span",{class:"token operator"},"..."),a(),n("span",{class:"token punctuation"},"}"),a(`
`),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code "),n("span",{class:"token operator"},"==="),a(),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(),n("span",{class:"token operator"},"..."),a(),n("span",{class:"token punctuation"},"}"),a(`
`),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},"// We got a 500 error here;"),a(`
  `),n("span",{class:"token comment"},'// We redirect to our "error500" route newly defined at step #1.'),a(`
  res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'error500'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token comment"},"// keep account of publicPath though!"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]}),_:1},m,t)),c(`<div class="doc-note doc-note--danger"${t}><p class="doc-note__title"${t}>WARNING</p><p${t}>The only caveat is that you need to be sure that while rendering ‘/error500’ route you don’t get another 500 error, which would put your app into an infinite loop!</p></div><p${t}>A perfect approach to avoid this would simply be to directly return the HTML (as String) of the error 500 page from <code class="doc-token"${t}>/src-ssr/middlewares/render.js</code>:</p>`),c(l(p(r),null,{default:u((k,e,i,s)=>{if(e)e(`<pre class="doc-code"${s}><code${s}>res<span class="token punctuation"${s}>.</span><span class="token function"${s}>status</span><span class="token punctuation"${s}>(</span><span class="token number"${s}>500</span><span class="token punctuation"${s}>)</span><span class="token punctuation"${s}>.</span><span class="token function"${s}>send</span><span class="token punctuation"${s}>(</span><span class="token template-string"${s}><span class="token template-punctuation string"${s}>\`</span><span class="token string"${s}>&lt;html&gt;....&lt;/html&gt;</span><span class="token template-punctuation string"${s}>\`</span></span><span class="token punctuation"${s}>)</span></code></pre>`),e(l(o,null,null,i,s));else return[n("pre",{class:"doc-code"},[n("code",null,[a("res"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"<html>....</html>"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")")])]),n(o)]}),_:1},m,t));else return[n("p",null,[a("The handling of the 404 & 500 errors on SSR is a bit different than on the other modes (like SPA). If you check out "),n("code",{class:"doc-token"},"/src-ssr/middlewares/render.js"),a(", you will notice the following section:")]),n(p(r),null,{default:u(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"export"),a(),n("span",{class:"token keyword"},"default"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),a(" app"),n("span",{class:"token punctuation"},","),a(" resolve"),n("span",{class:"token punctuation"},","),a(" render"),n("span",{class:"token punctuation"},","),a(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},"// we capture any other Express route and hand it"),a(`
  `),n("span",{class:"token comment"},"// over to Vue and Vue Router to render our page"),a(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'*'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[a("req"),n("span",{class:"token punctuation"},","),a(" res")]),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
    res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setHeader"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Content-Type'"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token string"},"'text/html'"),n("span",{class:"token punctuation"},")"),a(`

    `),n("span",{class:"token function"},"render"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"then"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"html"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
        `),n("span",{class:"token comment"},"// now let's send the rendered html to the client"),a(`
        res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),a("html"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"catch"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"err"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token punctuation"},"{"),a(`
        `),n("span",{class:"token comment"},"// oops, we had an error while rendering the page"),a(`

        `),n("span",{class:"token comment"},"// we were told to redirect to another URL"),a(`
        `),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code"),n("span",{class:"token punctuation"},","),a(" err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token punctuation"},"}"),a(`
          `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(`
          `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// hmm, Vue Router could not find the requested route"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code "),n("span",{class:"token operator"},"==="),a(),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},'// Should reach here only if no "catch-all" route'),a(`
          `),n("span",{class:"token comment"},"// is defined in /src/routes"),a(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'404 | Page Not Found'"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// well, we treat any other code as error;"),a(`
        `),n("span",{class:"token comment"},"// if we're in dev mode, then we can use Quasar CLI"),a(`
        `),n("span",{class:"token comment"},"// to display a nice error page that contains the stack"),a(`
        `),n("span",{class:"token comment"},"// and other useful information"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("process"),n("span",{class:"token punctuation"},"."),a("env"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"DEV"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},"// serve.error is available on dev only"),a(`
          serve`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),a(" err"),n("span",{class:"token punctuation"},","),a(" req"),n("span",{class:"token punctuation"},","),a(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
        `),n("span",{class:"token comment"},"// we're in production, so we should have another method"),a(`
        `),n("span",{class:"token comment"},"// to display something to the client when we encounter an error"),a(`
        `),n("span",{class:"token comment"},"// (for security reasons, it's not ok to display the same wealth"),a(`
        `),n("span",{class:"token comment"},"// of information as we do in development)"),a(`
        `),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
          `),n("span",{class:"token comment"},"// Render Error Page on production or"),a(`
          `),n("span",{class:"token comment"},"// create a route (/src/routes) for an error page and redirect to it"),a(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'500 | Internal Server Error'"),n("span",{class:"token punctuation"},")"),a(`
        `),n("span",{class:"token punctuation"},"}"),a(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("p",null,"The section above is written after catching the other possible requests (like for /public folder, the manifest.json and service worker, etc). This is where we render the page with Vue and Vue Router."),n("h2",{id:"things-to-be-aware-of",class:"doc-heading doc-h2",onClick:k=>p(f)("things-to-be-aware-of")},"Things to be aware of",8,["onClick"]),n("p",null,"We’ll discuss some architectural decisions that you need to be aware of. Choose whatever fits your app best."),n("h3",{id:"error-404",class:"doc-heading doc-h3",onClick:k=>p(f)("error-404")},"Error 404",8,["onClick"]),n("p",null,[a("If you define an equivalent 404 route on your Vue Router "),n("code",{class:"doc-token"},"/src/router/routes.js"),a(" file (like below), then "),n("code",{class:"doc-token"},"if (err.code === 404) {"),a(" part from the example above will NEVER be "),n("code",{class:"doc-token"},"true"),a(" since Vue Router already handled it.")]),n(p(r),null,{default:u(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// Example of route for catching 404 with Vue Router"),a(`
`),n("span",{class:"token punctuation"},"{"),a(),n("span",{class:"token literal-property property"},"path"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token string"},"'/:catchAll(.*)*'"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token function-variable function"},"component"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token keyword"},"import"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'pages/Error404.vue'"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("h3",{id:"error-500",class:"doc-heading doc-h3",onClick:k=>p(f)("error-500")},"Error 500",8,["onClick"]),n("p",null,[a("On the "),n("code",{class:"doc-token"},"/src-ssr/middlewares/render.js"),a(" example at the top of the page, notice that if the webserver encounters any rendering error, we send a simple string back to the client (‘500 | Internal Server Error’). If you want to show a nice page instead, you could:")]),n("ol",null,[n("li",null,[a("Add a specific route in "),n("code",{class:"doc-token"},"/src/router/routes.js"),a(", like:")])]),n(p(r),null,{default:u(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token punctuation"},"{"),a(),n("span",{class:"token literal-property property"},"path"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token string"},"'error500'"),n("span",{class:"token punctuation"},","),a(),n("span",{class:"token function-variable function"},"component"),n("span",{class:"token operator"},":"),a(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token operator"},"=>"),a(),n("span",{class:"token keyword"},"import"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'pages/Error500.vue'"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("ol",{start:"2"},[n("li",null,[a("Write the Vue component to handle this page. In this example, we create "),n("code",{class:"doc-token"},"/src/pages/Error500.vue")]),n("li",null,[a("Then in "),n("code",{class:"doc-token"},"/src-ssr/middlewares/render.js"),a(":")])]),n(p(r),null,{default:u(()=>[n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("url"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(),n("span",{class:"token operator"},"..."),a(),n("span",{class:"token punctuation"},"}"),a(`
`),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token keyword"},"if"),a(),n("span",{class:"token punctuation"},"("),a("err"),n("span",{class:"token punctuation"},"."),a("code "),n("span",{class:"token operator"},"==="),a(),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token punctuation"},"{"),a(),n("span",{class:"token operator"},"..."),a(),n("span",{class:"token punctuation"},"}"),a(`
`),n("span",{class:"token keyword"},"else"),a(),n("span",{class:"token punctuation"},"{"),a(`
  `),n("span",{class:"token comment"},"// We got a 500 error here;"),a(`
  `),n("span",{class:"token comment"},'// We redirect to our "error500" route newly defined at step #1.'),a(`
  res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),a("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'error500'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),a(),n("span",{class:"token comment"},"// keep account of publicPath though!"),a(`
`),n("span",{class:"token punctuation"},"}")])]),n(o)]),_:1}),n("div",{class:"doc-note doc-note--danger"},[n("p",{class:"doc-note__title"},"WARNING"),n("p",null,"The only caveat is that you need to be sure that while rendering ‘/error500’ route you don’t get another 500 error, which would put your app into an infinite loop!")]),n("p",null,[a("A perfect approach to avoid this would simply be to directly return the HTML (as String) of the error 500 page from "),n("code",{class:"doc-token"},"/src-ssr/middlewares/render.js"),a(":")]),n(p(r),null,{default:u(()=>[n("pre",{class:"doc-code"},[n("code",null,[a("res"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"<html>....</html>"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")")])]),n(o)]),_:1})]}),_:1},v))}}},g=d.setup;d.setup=(w,$)=>{const h=R();return(h.modules||(h.modules=new Set)).add("src/pages/quasar-cli-webpack/developing-ssr/handling-404-and-500-errors.md"),g?g(w,$):void 0};const U=x(d,[["__file","handling-404-and-500-errors.md"]]);export{U as default};
