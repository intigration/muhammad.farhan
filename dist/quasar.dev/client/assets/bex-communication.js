import{c as a}from"./_examples_frameless-electron-window.js";import{D as u}from"./DocPage.js";import{D as c}from"./DocPrerender.js";import{C as l}from"./CopyButton.js";import{_ as d}from"./index.js";import{b as h,d as g,w as r,h as n,f as o,e as s,i as e}from"./vendor.js";const k=n("p",null,[e("Allowing a Quasar App to communicate with the various parts of the BEX is essential. Quasar closes this gap using a "),n("code",{class:"doc-token"},"bridge"),e(".")],-1),m=n("p",null,"There are 4 areas in a BEX which will need a communication layer:",-1),f=n("ol",null,[n("li",null,"The Quasar App itself - this is true for all types of BEX i.e Popup, Options Page, Dev Tools or Web Page"),n("li",null,"Background Script"),n("li",null,"Content Script"),n("li",null,"The web page that the BEX is running on")],-1),w=n("p",null,"There is a fundamental rule to understand with the communication bridge in Quasar.",-1),v=n("p",null,[n("strong",null,"Not all BEX types have a content script"),e(" - Only BEX which run in the context of a web page will have a content script. This is how browser extensions in general work. This means if you’re adding a listener for an event on a content script and trying to trigger it from a Quasar BEX running as Dev Tools, Options Page or Popup - "),n("strong",null,"it won’t work"),e(".")],-1),b=n("p",null,"If you want to allow your Dev Tools, Popup or Options Page BEX to communicate with a web page, you will need to use the background script as a proxy. You would do this by:",-1),_=n("ol",null,[n("li",null,"Adding a listener on the background script which in turn emits another event."),n("li",null,"Add a listener to your Quasar App running in the Web Page context which listens for the event the background script is raising"),n("li",null,"Emitting the event to your background script from your Dev Tools, Popup or Options Page.")],-1),y=n("p",null,"Once you get your head around this concept, there are no limits to how the BEX can communicate with each part.",-1),B=n("p",null,"The bridge is a promise based event system which is shared between all parts of the BEX and as such allows you to listen for events in your Quasar App, emit them from other parts or vice versa. This is what gives Quasar BEX mode it’s power.",-1),T=n("p",null,[e("To access the bridge from within your Quasar App you can use "),n("code",{class:"doc-token"},"$q.bex"),e(". In other areas, the bridge is made available via the "),n("code",{class:"doc-token"},"bridge"),e(" parameter in the respective hook files.")],-1),x=n("p",null,"Let’s see how it works.",-1),C=n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"const"),e(),n("span",{class:"token punctuation"},"{"),e(" data "),n("span",{class:"token punctuation"},"}"),e(),n("span",{class:"token operator"},"="),e(),n("span",{class:"token keyword"},"await"),e(" bridge"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'some.event'"),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token punctuation"},"{"),e(),n("span",{class:"token literal-property property"},"someKey"),n("span",{class:"token operator"},":"),e(),n("span",{class:"token string"},"'aValue'"),e(),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),e(`
console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Some response from the other side'"),n("span",{class:"token punctuation"},","),e(" data"),n("span",{class:"token punctuation"},")")])],-1),E=n("p",null,"You can respond to let the caller know the operation is done. You can optionally return back some data too.",-1),P=n("pre",{class:"doc-code"},[n("code",null,[e("bridge"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"on"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'some.event'"),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),e(" data"),n("span",{class:"token punctuation"},","),e(" respond "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),e(),n("span",{class:"token operator"},"=>"),e(),n("span",{class:"token punctuation"},"{"),e(`
  console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"log"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Event receieved, responding...'"),n("span",{class:"token punctuation"},")"),e(`
  `),n("span",{class:"token function"},"respond"),n("span",{class:"token punctuation"},"("),e("data"),n("span",{class:"token punctuation"},"."),e("someKey "),n("span",{class:"token operator"},"+"),e(),n("span",{class:"token string"},"' hey!'"),n("span",{class:"token punctuation"},")"),e(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")")])],-1),X=n("div",{class:"doc-note doc-note--warning"},[n("p",{class:"doc-note__title"},"WARNING"),n("p",null,[e("If you omit "),n("code",{class:"doc-token"},"respond()"),e(" the promise on "),n("code",{class:"doc-token"},".send()"),e(" will not resolve.")])],-1),Q=n("p",null,[e("The Quasar bridge does some work behind the scenes to convert the normal event based communication into promises and as such, in order for the promise to resolve, we need to call "),n("code",{class:"doc-token"},"respond"),e(".")],-1),A=n("pre",{class:"doc-code"},[n("code",null,[e("bridge"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"off"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'some.event'"),n("span",{class:"token punctuation"},","),e(),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),e("someFunction"),n("span",{class:"token punctuation"},")")])],-1),D=n("div",{class:"doc-note doc-note--tip"},[n("p",{class:"doc-note__title"},"TIP"),n("p",null,"The bridge also does some work to split large data which is too big to be transmitted in one go due to the browser extension 60mb data transfer limit. In order for this to happen, the payload must be an array.")],-1),I={__name:"bex-communication",setup(N){const p=[{id:"communication-rules",title:"2. Communication Rules"},{id:"the-bridge",title:"3. The Bridge"},{id:"trigger-an-event-and-wait-for-the-response",title:"3.1. Trigger an event and wait for the response",sub:!0},{id:"listen-for-an-event-and-sending-a-response",title:"3.2. Listen for an event and sending a response",sub:!0},{id:"clean-up-your-listeners",title:"3.3. Clean up your listeners",sub:!0}];return(O,t)=>(h(),g(u,{title:"BEX Communication",desc:"(@quasar/app-vite) How to communicate between different parts of your Browser Extension (BEX) in Quasar.",overline:"Quasar CLI with Vite - @quasar/app-vite",heading:"","edit-link":"quasar-cli-vite/developing-browser-extensions/bex-communication",toc:p},{default:r(()=>[k,m,f,n("h2",{id:"communication-rules",class:"doc-heading doc-h2",onClick:t[0]||(t[0]=i=>o(a)("communication-rules"))},"Communication Rules"),w,v,b,_,y,n("h2",{id:"the-bridge",class:"doc-heading doc-h2",onClick:t[1]||(t[1]=i=>o(a)("the-bridge"))},"The Bridge"),B,T,x,n("h3",{id:"trigger-an-event-and-wait-for-the-response",class:"doc-heading doc-h3",onClick:t[2]||(t[2]=i=>o(a)("trigger-an-event-and-wait-for-the-response"))},"Trigger an event and wait for the response"),s(o(c),null,{default:r(()=>[C,s(l)]),_:1}),n("h3",{id:"listen-for-an-event-and-sending-a-response",class:"doc-heading doc-h3",onClick:t[3]||(t[3]=i=>o(a)("listen-for-an-event-and-sending-a-response"))},"Listen for an event and sending a response"),E,s(o(c),null,{default:r(()=>[P,s(l)]),_:1}),X,Q,n("h3",{id:"clean-up-your-listeners",class:"doc-heading doc-h3",onClick:t[4]||(t[4]=i=>o(a)("clean-up-your-listeners"))},"Clean up your listeners"),s(o(c),null,{default:r(()=>[A,s(l)]),_:1}),D]),_:1}))}},W=d(I,[["__file","bex-communication.md"]]);export{W as default};
