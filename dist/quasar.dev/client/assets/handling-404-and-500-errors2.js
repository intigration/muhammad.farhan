import{c as r}from"./_examples_frameless-electron-window.js";import{D as i}from"./DocPage.js";import{D as c}from"./DocPrerender.js";import{C as p}from"./CopyButton.js";import{_ as k}from"./index.js";import{b as d,d as h,w as o,e as t,f as a,h as n,i as s}from"./vendor.js";const m=n("p",null,[s("The handling of the 404 & 500 errors on SSR is a bit different than on the other modes (like SPA). If you check out "),n("code",{class:"doc-token"},"/src-ssr/middlewares/render.js"),s(", you will notice the following section:")],-1),f=n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"export"),s(),n("span",{class:"token keyword"},"default"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[n("span",{class:"token punctuation"},"{"),s(" app"),n("span",{class:"token punctuation"},","),s(" resolve"),n("span",{class:"token punctuation"},","),s(" render"),n("span",{class:"token punctuation"},","),s(" serve "),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// we capture any other Express route and hand it"),s(`
  `),n("span",{class:"token comment"},"// over to Vue and Vue Router to render our page"),s(`
  app`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'*'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},[s("req"),n("span",{class:"token punctuation"},","),s(" res")]),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
    res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setHeader"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'Content-Type'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'text/html'"),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token function"},"render"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" req"),n("span",{class:"token punctuation"},","),s(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"then"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"html"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// now let's send the rendered html to the client"),s(`
        res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),s("html"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
      `),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"catch"),n("span",{class:"token punctuation"},"("),n("span",{class:"token parameter"},"err"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// oops, we had an error while rendering the page"),s(`

        `),n("span",{class:"token comment"},"// we were told to redirect to another URL"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},"."),s("url"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},"."),s("code"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},"."),s("code"),n("span",{class:"token punctuation"},","),s(" err"),n("span",{class:"token punctuation"},"."),s("url"),n("span",{class:"token punctuation"},")"),s(`
          `),n("span",{class:"token punctuation"},"}"),s(`
          `),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
            res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},"."),s("url"),n("span",{class:"token punctuation"},")"),s(`
          `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token comment"},"// hmm, Vue Router could not find the requested route"),s(`
        `),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},"."),s("code "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token comment"},'// Should reach here only if no "catch-all" route'),s(`
          `),n("span",{class:"token comment"},"// is defined in /src/routes"),s(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'404 | Page Not Found'"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token comment"},"// well, we treat any other code as error;"),s(`
        `),n("span",{class:"token comment"},"// if we're in dev mode, then we can use Quasar CLI"),s(`
        `),n("span",{class:"token comment"},"// to display a nice error page that contains the stack"),s(`
        `),n("span",{class:"token comment"},"// and other useful information"),s(`
        `),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("process"),n("span",{class:"token punctuation"},"."),s("env"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"DEV"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token comment"},"// serve.error is available on dev only"),s(`
          serve`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"{"),s(" err"),n("span",{class:"token punctuation"},","),s(" req"),n("span",{class:"token punctuation"},","),s(" res "),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token comment"},"// we're in production, so we should have another method"),s(`
        `),n("span",{class:"token comment"},"// to display something to the client when we encounter an error"),s(`
        `),n("span",{class:"token comment"},"// (for security reasons, it's not ok to display the same wealth"),s(`
        `),n("span",{class:"token comment"},"// of information as we do in development)"),s(`
        `),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
          `),n("span",{class:"token comment"},"// Render Error Page on production or"),s(`
          `),n("span",{class:"token comment"},"// create a route (/src/routes) for an error page and redirect to it"),s(`
          res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'500 | Internal Server Error'"),n("span",{class:"token punctuation"},")"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
      `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
  `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"}")])],-1),w=n("p",null,"The section above is written after catching the other possible requests (like for /public folder, the manifest.json and service worker, etc). This is where we render the page with Vue and Vue Router.",-1),g=n("p",null,"We’ll discuss some architectural decisions that you need to be aware of. Choose whatever fits your app best.",-1),y=n("p",null,[s("If you define an equivalent 404 route on your Vue Router "),n("code",{class:"doc-token"},"/src/router/routes.js"),s(" file (like below), then "),n("code",{class:"doc-token"},"if (err.code === 404) {"),s(" part from the example above will NEVER be "),n("code",{class:"doc-token"},"true"),s(" since Vue Router already handled it.")],-1),_=n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token comment"},"// Example of route for catching 404 with Vue Router"),s(`
`),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"path"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'/:catchAll(.*)*'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function-variable function"},"component"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token keyword"},"import"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'pages/Error404.vue'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"}")])],-1),v=n("p",null,[s("On the "),n("code",{class:"doc-token"},"/src-ssr/middlewares/render.js"),s(" example at the top of the page, notice that if the webserver encounters any rendering error, we send a simple string back to the client (‘500 | Internal Server Error’). If you want to show a nice page instead, you could:")],-1),b=n("ol",null,[n("li",null,[s("Add a specific route in "),n("code",{class:"doc-token"},"/src/router/routes.js"),s(", like:")])],-1),E=n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token literal-property property"},"path"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token string"},"'error500'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token function-variable function"},"component"),n("span",{class:"token operator"},":"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(),n("span",{class:"token keyword"},"import"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'pages/Error500.vue'"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"}")])],-1),V=n("ol",{start:"2"},[n("li",null,[s("Write the Vue component to handle this page. In this example, we create "),n("code",{class:"doc-token"},"/src/pages/Error500.vue")]),n("li",null,[s("Then in "),n("code",{class:"doc-token"},"/src-ssr/middlewares/render.js"),s(":")])],-1),x=n("pre",{class:"doc-code"},[n("code",null,[n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},"."),s("url"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token operator"},"..."),s(),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("err"),n("span",{class:"token punctuation"},"."),s("code "),n("span",{class:"token operator"},"==="),s(),n("span",{class:"token number"},"404"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(),n("span",{class:"token operator"},"..."),s(),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token keyword"},"else"),s(),n("span",{class:"token punctuation"},"{"),s(`
  `),n("span",{class:"token comment"},"// We got a 500 error here;"),s(`
  `),n("span",{class:"token comment"},'// We redirect to our "error500" route newly defined at step #1.'),s(`
  res`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"redirect"),n("span",{class:"token punctuation"},"("),s("resolve"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"urlPath"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'error500'"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token comment"},"// keep account of publicPath though!"),s(`
`),n("span",{class:"token punctuation"},"}")])],-1),R=n("div",{class:"doc-note doc-note--danger"},[n("p",{class:"doc-note__title"},"WARNING"),n("p",null,"The only caveat is that you need to be sure that while rendering ‘/error500’ route you don’t get another 500 error, which would put your app into an infinite loop!")],-1),T=n("p",null,[s("A perfect approach to avoid this would simply be to directly return the HTML (as String) of the error 500 page from "),n("code",{class:"doc-token"},"/src-ssr/middlewares/render.js"),s(":")],-1),C=n("pre",{class:"doc-code"},[n("code",null,[s("res"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"status"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"500"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"send"),n("span",{class:"token punctuation"},"("),n("span",{class:"token template-string"},[n("span",{class:"token template-punctuation string"},"`"),n("span",{class:"token string"},"<html>....</html>"),n("span",{class:"token template-punctuation string"},"`")]),n("span",{class:"token punctuation"},")")])],-1),q={__name:"handling-404-and-500-errors",setup(I){const l=[{id:"things-to-be-aware-of",title:"2. Things to be aware of"},{id:"error-404",title:"2.1. Error 404",sub:!0},{id:"error-500",title:"2.2. Error 500",sub:!0}];return(P,e)=>(d(),h(i,{title:"SSR Handling of 404 and 500 Errors",desc:"(@quasar/app-webpack) Managing the common 404 and 500 HTTP errors in a Quasar server-side rendered app.",overline:"Quasar CLI with Webpack - @quasar/app-webpack",heading:"","edit-link":"quasar-cli-webpack/developing-ssr/handling-404-and-500-errors",toc:l},{default:o(()=>[m,t(a(c),null,{default:o(()=>[f,t(p)]),_:1}),w,n("h2",{id:"things-to-be-aware-of",class:"doc-heading doc-h2",onClick:e[0]||(e[0]=u=>a(r)("things-to-be-aware-of"))},"Things to be aware of"),g,n("h3",{id:"error-404",class:"doc-heading doc-h3",onClick:e[1]||(e[1]=u=>a(r)("error-404"))},"Error 404"),y,t(a(c),null,{default:o(()=>[_,t(p)]),_:1}),n("h3",{id:"error-500",class:"doc-heading doc-h3",onClick:e[2]||(e[2]=u=>a(r)("error-500"))},"Error 500"),v,b,t(a(c),null,{default:o(()=>[E,t(p)]),_:1}),V,t(a(c),null,{default:o(()=>[x,t(p)]),_:1}),R,T,t(a(c),null,{default:o(()=>[C,t(p)]),_:1})]),_:1}))}},H=k(q,[["__file","handling-404-and-500-errors.md"]]);export{H as default};
